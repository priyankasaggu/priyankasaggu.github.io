---
layout: post
title: "go workspaces usage in kubernetes project"
tags: [kubernetes]
comments: false
---


Kubernetes (k/k) [recently started](https://github.com/kubernetes/kubernetes/commit/65b841c077e0d3282d28b9199aec72d23d045104) using [**Go Workspaces**](https://go.dev/doc/tutorial/workspaces) to manage its multi-module setup more effectively.

The goal is to helps keep things consistent across the many staging repositories and the main k/k project.

At the root of the k/k repo, you’ll find `go.work` and `go.work.sum`.

These files are auto-generated by the [`hack/update-vendor.sh`](https://github.com/kubernetes/kubernetes/blob/73014647f9bdd7186b5fe121326b961d6521c162/hack/update-vendor.sh) script.

Specifically, the logic lives around [lines 198–219](https://github.com/kubernetes/kubernetes/blob/73014647f9bdd7186b5fe121326b961d6521c162/hack/update-vendor.sh#L198-L219) and [293–303](https://github.com/kubernetes/kubernetes/blob/73014647f9bdd7186b5fe121326b961d6521c162/hack/update-vendor.sh#L293-L303).

At a high level, the script runs the following commands from the root of the repo:

```bash
go work init
go work edit -go 1.24.0 -godebug default=go1.24
go work edit -use .

git ls-files -z ':(glob)./staging/src/k8s.io/*/go.mod' \
  | xargs -0 -n1 dirname -z \
  | xargs -0 -n1 go work edit -use

go mod download
go work vendor
```

This creates:

- [`go.work`](https://github.com/kubernetes/kubernetes/blob/master/go.work) file that includes the root module (.) and all the Kubernetes staging modules under [staging/src/k8s.io](https://github.com/kubernetes/kubernetes/tree/master/staging/src/k8s.io).

```go
go 1.24.0

godebug default=go1.24

use (
    .
    ./staging/src/k8s.io/api
    ./staging/src/k8s.io/apiextensions-apiserver
    ./staging/src/k8s.io/apimachinery
    ...
    ./staging/src/k8s.io/sample-controller
)
```

- [`go.work.sum`](https://github.com/kubernetes/kubernetes/blob/master/go.work.sum) file that tracks checksums for the workspace modules — like `go.sum`, but at the workspace level.

- and the [`vendor/`](https://github.com/kubernetes/kubernetes/tree/master/vendor) directory which is populated via `go work vendor` and collects all dependencies from the workspace modules.
